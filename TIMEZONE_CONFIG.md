# MongoDB 集群时区配置指南

## 🌍 当前配置（面向全球市场）

我们已经将时区配置优化为面向全球市场，特别是北美市场：

- **系统时区**: `UTC` (协调世界时)
- **备份时间**: `UTC 09:00` (每日)

## 🕐 时区对照表

### UTC 09:00 备份时间对应的本地时间：

⚠️ **注意**：下表显示的是**标准时间**，夏令时期间需要加1小时。

| 时区 | 标准时间 | 夏令时 | 说明 |
|------|----------|--------|------|
| **美国东部时间** | 凌晨 4:00 (EST) | 凌晨 5:00 (EDT) | 纽约、华盛顿 |
| **美国中部时间** | 凌晨 3:00 (CST) | 凌晨 4:00 (CDT) | 芝加哥、达拉斯 |
| **美国山地时间** | 凌晨 2:00 (MST) | 凌晨 3:00 (MDT) | 丹佛、亚利桑那 |
| **美国太平洋时间** | 凌晨 1:00 (PST) | 凌晨 2:00 (PDT) | 洛杉矶、旧金山 |
| **欧洲中部时间** | 上午 10:00 (CET) | 上午 11:00 (CEST) | 巴黎、柏林 |
| **英国时间** | 上午 9:00 (GMT) | 上午 10:00 (BST) | 伦敦 |
| **中国时间** | 下午 17:00 (CST) | - | 北京、上海 |
| **日本时间** | 下午 18:00 (JST) | - | 东京 |

## 🎯 为什么选择 UTC？

### 1. **全球标准**
- UTC是国际标准时间，不受夏令时影响
- 所有时间戳保持一致性，便于跨时区协作

### 2. **技术优势**
- 数据库日志时间统一，便于问题排查
- 备份和监控脚本逻辑简单可靠
- 避免夏令时切换带来的时间混乱

### 3. **业务优势**
- 全球用户看到统一的系统时间
- 便于多时区团队协作
- 符合国际化应用最佳实践

## 📊 备份时间策略

### UTC 09:00 的选择原因：

#### 🇺🇸 北美优化考虑：
- **标准时间** (11月-3月): 东海岸4:00AM，西海岸1:00AM
- **夏令时** (3月-11月): 东海岸5:00AM，西海岸2:00AM  
- **全年都是深夜时段**: 系统负载最低，用户活跃度最小

#### 💯 最佳实践优势：
1. **避开高峰时段**: 远离美国西海岸晚间活跃时间
2. **维护窗口理想**: 数据库管理员友好的操作时间
3. **全球平衡**: 欧洲上班时间，亚洲下班时间，北美深夜

## 🔧 其他时区选项

如果您需要调整为其他时区，可以修改 `.env` 文件：

### 美国东部时间
```bash
TZ=America/New_York
BACKUP_SCHEDULE=0 2 * * *  # 当地时间 2:00 AM
```

### 美国太平洋时间
```bash
TZ=America/Los_Angeles
BACKUP_SCHEDULE=0 3 * * *  # 当地时间 3:00 AM
```

### 欧洲中部时间
```bash
TZ=Europe/Paris
BACKUP_SCHEDULE=0 3 * * *  # 当地时间 3:00 AM
```

## 📱 应用程序时区处理建议

### 前端显示
```javascript
// 将UTC时间转换为用户本地时间
const utcDate = new Date(dbTimestamp);
const localTime = utcDate.toLocaleString();
```

### 后端API
```javascript
// 总是存储UTC时间到数据库
const utcTimestamp = new Date().toISOString();
```

### 数据库查询
```javascript
// MongoDB查询使用UTC时间
db.collection.find({
  createdAt: {
    $gte: new Date('2024-01-01T00:00:00.000Z'),
    $lt: new Date('2024-01-02T00:00:00.000Z')
  }
});
```

## 🔄 时区切换步骤

如果需要更改时区配置：

1. **停止服务**
   ```bash
   docker-compose down
   ```

2. **修改配置**
   ```bash
   nano .env
   # 修改 TZ= 和 BACKUP_SCHEDULE=
   ```

3. **重启服务**
   ```bash
   docker-compose up -d
   ```

4. **验证配置**
   ```bash
   docker exec -it mongo-primary date
   ```

## ⚠️ 注意事项

1. **一致性很重要** - 所有服务器保持相同的时区配置
2. **文档更新** - 时区变更后更新相关文档
3. **测试验证** - 变更后验证备份和监控脚本正常工作
4. **用户通知** - 如影响用户，提前通知时区变更

## 🌐 全球化最佳实践

1. **始终使用UTC存储** - 数据库中所有时间戳使用UTC
2. **本地化显示** - 前端根据用户时区显示本地时间
3. **明确时区标识** - API响应包含时区信息
4. **夏令时处理** - 避免硬编码时区偏移量

---

**💡 推荐**: 对于全球化应用，保持当前的UTC配置是最佳选择！ 