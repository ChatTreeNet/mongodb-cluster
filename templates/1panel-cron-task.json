{
  "name": "MongoDB集群自动备份",
  "description": "MongoDB副本集集群的自动备份任务，支持本地备份、1Panel集成和存储桶备份",
  "type": "shell",
  "spec": "0 2 * * *",
  "command": "/path/to/mongodb-cluster/scripts/1panel-cron-backup.sh",
  "timeout": 3600,
  "retries": 2,
  "status": "enable",
  "email_notification": true,
  "webhook_notification": false,
  "tags": ["mongodb", "backup", "database"],
  "environment_variables": {
    "PROJECT_PATH": "/path/to/mongodb-cluster",
    "BACKUP_MODE": "auto",
    "LOG_LEVEL": "info"
  },
  "advanced_options": {
    "execution_user": "root",
    "working_directory": "/path/to/mongodb-cluster",
    "shell": "/bin/bash",
    "redirect_stdout": true,
    "redirect_stderr": true
  },
  "schedule_options": [
    {
      "name": "每日备份（推荐）",
      "cron": "0 2 * * *",
      "description": "每天凌晨2点执行备份"
    },
    {
      "name": "每12小时备份",
      "cron": "0 */12 * * *",
      "description": "每12小时执行一次备份"
    },
    {
      "name": "工作日备份",
      "cron": "0 23 * * 1-5",
      "description": "工作日晚上11点备份"
    },
    {
      "name": "每周备份",
      "cron": "0 3 * * 0",
      "description": "每周日凌晨3点备份"
    },
    {
      "name": "每月备份",
      "cron": "0 1 1 * *",
      "description": "每月1号凌晨1点备份"
    }
  ],
  "notification_templates": {
    "success": {
      "title": "MongoDB备份成功",
      "message": "MongoDB集群备份已成功完成。\n执行时间: {{.ExecuteTime}}\n耗时: {{.Duration}}秒\n备份大小: {{.BackupSize}}"
    },
    "failure": {
      "title": "MongoDB备份失败",
      "message": "MongoDB集群备份执行失败。\n执行时间: {{.ExecuteTime}}\n错误信息: {{.ErrorMessage}}\n请检查日志: {{.LogPath}}"
    }
  },
  "prerequisite_checks": [
    {
      "name": "检查MongoDB容器状态",
      "command": "docker ps --filter 'name=mongo-primary' --format '{{.Names}}' | grep -q 'mongo-primary'",
      "description": "确保MongoDB主节点容器正在运行"
    },
    {
      "name": "检查磁盘空间",
      "command": "df -h /path/to/mongodb-cluster/backups | awk 'NR==2 {print $5}' | sed 's/%//' | awk '{if($1>90) exit 1}'",
      "description": "确保备份目录有足够的磁盘空间（<90%）"
    },
    {
      "name": "检查环境配置",
      "command": "test -f /path/to/mongodb-cluster/.env",
      "description": "确保环境配置文件存在"
    }
  ],
  "post_execution_actions": [
    {
      "name": "清理临时文件",
      "command": "find /path/to/mongodb-cluster/logs -name '*.tmp' -mtime +1 -delete",
      "condition": "always"
    },
    {
      "name": "更新备份状态",
      "command": "echo \"$(date): 备份完成\" >> /path/to/mongodb-cluster/logs/backup-history.log",
      "condition": "on_success"
    }
  ],
  "monitoring": {
    "health_check_url": "http://localhost:8080/api/v1/mongodb/health",
    "metrics_collection": true,
    "log_retention_days": 30,
    "alert_on_consecutive_failures": 3
  },
  "installation_instructions": {
    "step1": "确保MongoDB集群已通过Git方式部署",
    "step2": "修改command字段中的路径为实际的项目路径",
    "step3": "根据需要调整cron表达式和其他配置",
    "step4": "在1Panel中导入此配置或手动创建任务",
    "step5": "启用任务并进行测试运行"
  }
} 